<!doctype html><html><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><title>Integration Test - DPTechLab</title><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Integration Test part1 What is Integration Test Integration test is kinds of test suite which performs end to end testing of your application. Let&rsquo;s try to understand with an example what includes in end to end testing.
For example if we have microservice which is serving APIs for customer&rsquo;s crud and maintain data in to postgres database. Now as part of Integration test we will cover following test cases for each api endpoint."><meta property="og:image" content><meta property="og:title" content="Integration Test"><meta property="og:description" content="Integration Test part1 What is Integration Test Integration test is kinds of test suite which performs end to end testing of your application. Let&rsquo;s try to understand with an example what includes in end to end testing.
For example if we have microservice which is serving APIs for customer&rsquo;s crud and maintain data in to postgres database. Now as part of Integration test we will cover following test cases for each api endpoint."><meta property="og:type" content="article"><meta property="og:url" content="https://ardbp.github.io/dpcontent/posts/post/integrationtest/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-11-01T00:00:00+00:00"><meta property="article:modified_time" content="2022-11-14T00:00:00+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Integration Test"><meta name=twitter:description content="Integration Test part1 What is Integration Test Integration test is kinds of test suite which performs end to end testing of your application. Let&rsquo;s try to understand with an example what includes in end to end testing.
For example if we have microservice which is serving APIs for customer&rsquo;s crud and maintain data in to postgres database. Now as part of Integration test we will cover following test cases for each api endpoint."><script src=https://ardbp.github.io/dpcontent/js/feather.min.js></script>
<link href=https://ardbp.github.io/dpcontent/css/fonts.2c2227b81b1970a03e760aa2e6121cd01f87c88586803cbb282aa224720a765f.css rel=stylesheet><link rel=stylesheet type=text/css media=screen href=https://ardbp.github.io/dpcontent/css/main.ac08a4c9714baa859217f92f051deb58df2938ec352b506df655005dcaf98cc0.css><link id=darkModeStyle rel=stylesheet type=text/css href=https://ardbp.github.io/dpcontent/css/dark.726cd11ca6eb7c4f7d48eb420354f814e5c1b94281aaf8fd0511c1319f7f78a4.css media="(prefers-color-scheme: dark)"></head><body><div class=content><header><div class=main><a href=https://ardbp.github.io/dpcontent/>DPTechLab</a></div><nav><a href=/dpcontent/>Home</a>
<a href=/dpcontent/posts>All posts</a>
<a href=/dpcontent/tags>Tags</a></nav></header><main><article><div class=title><h1 class=title>Integration Test</h1><div class=meta>Posted on Nov 1, 2022</div></div><section class=body><h1 id=integration-test-part1><strong>Integration Test part1</strong></h1><h2 id=what-is-integration-test><strong>What is Integration Test</strong></h2><p>Integration test is kinds of test suite which performs end to end testing of your application. Let&rsquo;s try to understand with an example what includes in end to end testing.</p><p>For example if we have microservice which is serving APIs for customer&rsquo;s crud and maintain data in to postgres database. Now as part of Integration test we will cover following test cases for each api endpoint.</p><ul><li>Success test case which validate you can create/update/delete/get customer resource with valid test data</li><li>Failure test cases<ul><li>Bad Request for Invalid data for all API endpoints</li><li>Internal Server Error for the failure scenarios where service isn&rsquo;t reachable to postgres or any other scenarios where it can&rsquo;t process the request.</li></ul></li></ul><h2 id=how-to-write-integration-test><strong>How to write integration test</strong></h2><p>As integration test will be testing end-to-end functionlity of your application we should testing our application same way how end user is going to use it.</p><p>Let&rsquo;s take a this example where I have Microservice which provides gRPC APIs for customer create and get endpoints. Here is proto defination for this service.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>// CustomerService will provide two gRPC endpoint 
</span></span><span style=display:flex><span>service CustomerService {
</span></span><span style=display:flex><span>  // GetCustomer will retrieve customer
</span></span><span style=display:flex><span>  rpc GetCustomer (GetCustomerRequest) returns (Customer){};
</span></span><span style=display:flex><span>  // CreateCustomer will allow to create customer
</span></span><span style=display:flex><span>  rpc CreateCustomer (Customer) returns (CustomerResponse){};
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>// GetCustomerRequest customer request payload
</span></span><span style=display:flex><span>message GetCustomerRequest {
</span></span><span style=display:flex><span>  int64 id = 1;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>message Customer {
</span></span><span style=display:flex><span>  string name = 1;
</span></span><span style=display:flex><span>  int64 id = 2;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>// CustomerResponse customer response payload
</span></span><span style=display:flex><span>message CustomerResponse{}
</span></span></code></pre></div><p>So when end user will be using this service they will interect with either create or get RPC endpoint, Similarly we will be writing the test which will call both endpoints using generated gRPC client from above protobuf.</p><p>Let&rsquo;s write integration test for create endpoint</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>
</span></span><span style=display:flex><span>func TestCreateCustomerWithSuccessResponse(t *testing.T) {
</span></span><span style=display:flex><span>	_, err := (getClient()).CreateCustomer(context.Background(), &amp;api.Customer{Id: 1, Name: &#34;test&#34;})
</span></span><span style=display:flex><span>	if err != nil {
</span></span><span style=display:flex><span>		t.Errorf(&#34;failed to create customer with error: %v&#34;, err)
</span></span><span style=display:flex><span>		t.Fail()
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>func TestCreateCustomerWithBadRequestResponse(t *testing.T) {
</span></span><span style=display:flex><span>	_, err := (getClient()).CreateCustomer(context.Background(), &amp;api.Customer{})
</span></span><span style=display:flex><span>	if err == nil {
</span></span><span style=display:flex><span>		t.Errorf(&#34;failed to receive BadRequest response&#34;)
</span></span><span style=display:flex><span>		t.Fail()
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	st, ok := status.FromError(err)
</span></span><span style=display:flex><span>	if !ok {
</span></span><span style=display:flex><span>		t.Errorf(&#34;Invalid response code&#34;)
</span></span><span style=display:flex><span>		t.Fail()
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	if st.Code() != codes.InvalidArgument {
</span></span><span style=display:flex><span>		t.Errorf(&#34;Invalid response code&#34;)
</span></span><span style=display:flex><span>		t.Fail()
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>This examples shows two different tests, where first test verify successful customer creation using correct data. 2nd test verify that customer create api return <code>InvalidArgument</code> response for invalid request data.</p><p>In both tests it uses generated gRPC client from protobuf defination, it has been provided using <code>getClient()</code> method. Here is the code for getClient.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>func getClient() api.CustomerServiceClient {
</span></span><span style=display:flex><span>	appURL := os.Getenv(&#34;APP_DSN&#34;)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	// connect to the grpc server
</span></span><span style=display:flex><span>	conn, err := grpc.Dial(appURL, grpc.WithTransportCredentials(insecure.NewCredentials()))
</span></span><span style=display:flex><span>	if err != nil {
</span></span><span style=display:flex><span>		log.Print(&#34;did not connect:&#34;, err)
</span></span><span style=display:flex><span>		return nil
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	return api.NewCustomerServiceClient(conn)
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>In this article we have talk about how to write basic integration test, In next article I will walk you through how to run this tests in local environment and on ci/cd using github actions.</p></section><div class=post-tags><nav class="nav tags"><ul class=tags><li><a href=/tags/test>test</a></li><li><a href=/tags/integration-test>integration test</a></li><li><a href=/tags/golang>golang</a></li></ul></nav></div></article></main><footer><div style=display:flex><a class=soc href=https://github.com/ardbp title=GitHub><i data-feather=github></i></a>
<a class=border></a><a class=soc href=https://www.linkedin.com/in/daxesh-panchal title=LinkedIn><i data-feather=linkedin></i></a>
<a class=border></a></div><div class=footer-info>2022 © DPTechLab |</div></footer><script>feather.replace()</script></div></body></html>